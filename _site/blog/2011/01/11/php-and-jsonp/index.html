<!DOCTYPE html>
<html>
<head>
<title> PHP and JSONP - Felix
	Kling</title>
<link href="/assets/css/main.css" rel="stylesheet" type="text/css" />
<link href="/assets/css/sunburst.css" rel="stylesheet" type="text/css" />
<script src="/assets/js/prettify.js"></script>
<script>
	window.onload = function() {
		var a = false;
		var codes = document.getElementsByTagName('code');
		for ( var i = codes.length; i--;) {
			codes[i].parentNode.classList.add('prettyprint');
			a = true;
		}
		if (a) {
			prettyPrint()
		}
	}
</script>
</head>
<body>
	<div id="main">
		<header id="header">
			<h1>{
				 <a href="/"
					title="return to home">Felix Kling</a>
			}</h1>
				
				<ul class="menu">
    
        <li class="entry">
        <a  href="/pages/projects.html">projects</a>
        </li>
    
        <li class="entry active">
        <a  href="/pages/log.html">log</a>
        </li>
    
        <li class="entry">
        <a  href="/pages/about.html">about</a>
        </li>
    
</ul>

		</header>
		<div id="content">
		<div id="post" class="text script">
    <div class="header">
        <h2>PHP and JSONP</h2>
        <div class="meta">
            <span class="date">11 Jan 2011</span>
            <!--  
            
            <span class="category">php, json, jsonp</span>
            -->
        </div>
    </div>
    <p>Since PHP 5.2, with <a href='http://www.php.net/manual/en/function.json-decode.php'><code>json_decode</code></a>, we have an easy way to decode <a href='http://json.org/'>JSON</a> data. But sometimes, the only data we can get is actually <a href='http://en.wikipedia.org/wiki/JSON#JSONP'>JSONP</a>, that is JSON data wrapped in a function call like:</p>

<pre><code>callback({/*.. JSON data .. */});</code></pre>

<p>It is not difficult to use some string functions to remove this &#8220;overhead&#8221;. Here is an example implementation of <code>jsonp_decode</code> (which offers the same interface as <code>json_decode</code>):</p>

<pre><code>function jsonp_decode($jsonp, $assoc = false) { 
    // PHP 5.3 adds &quot;depth&quot; as third parameter to json_decode
    if($jsonp[0] !== &#39;[&#39; &amp;&amp; $jsonp[0] !== &#39;{&#39;) { // we have JSONP
        $jsonp = substr($jsonp, strpos($jsonp, &#39;(&#39;));
    }
    return json_decode(trim($jsonp,&#39;();&#39;), $assoc);
}</code></pre>

<p>And example implementation for creating a JSONP string:</p>

<pre><code>function jsonp_encode($value, $function_name = &#39;cb&#39;) { 
    // 5.3 adds &quot;options&quot; as second parameter to json_encode
    return sprintf(&#39;%s(%s);&#39;, trim($function_name, &#39;();&#39;), json_encode($value));
}</code></pre>
<hr />
<p><strong>Update:</strong></p>

<p>The code is now <a href='https://github.com/fkling/PHP-functions'>available on GitHub</a>.</p>
    

</div>

		      <div id="footer">
        &copy; 2011 by Felix Kling <br />
        This web site uses the Open Source web analytics 
        software <a href="http://piwik.org/">Piwik</a>. 
        You can <a href="/piwik_opt_out.html"><strong>opt out</strong></a> from this.
        </div>
		</div>

	</div>
	<!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.reblaus-kleinkunst.de/" : "http://piwik.reblaus-kleinkunst.de/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 2);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://piwik.reblaus-kleinkunst.de/piwik.php?idsite=2" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->
</body>
</html>
